# Vulcano AI Data Service (GitHub-backed)

Status: Stable on DEBUG006 (Sep 13, 2025)

This document defines the data contract, file layout, versioning and SLOs for Vulcano AI’s GitHub‑backed data service. It is the single source of truth for how the website, workflows, and any third‑party consumers interact with published JSON.

## Overview
- Source of truth: this repository (`vulcanoai/vulcanoai.github.io`)
- Publisher: n8n workflow “DEBUG006” (manual trigger)
- Consumers: Vulcano AI website, programmatic clients (read-only)
- Transport: static JSON files committed to GitHub Pages

## File Layout
- `data/runs/<ISO>.json` — per‑run snapshot (complete articles array + params)
- `data/entries/YYYY-MM-DD/*.json` — one JSON per article (durable record)
- `data/entries/YYYY-MM-DD/index.json` — per‑day counts by topic/country
- `data/feed-latest.json` — rolling merged feed (most recent first)
- `data/feed-YYYY-MM-DD.json` — daily merged feed (accumulates across runs)

## Contracts (Schemas)
JSON Schemas are provided under `docs/schemas/`:
- `article.v1.json` — article objects (also elements in feeds and runs)
- `daily-index.v1.json` — `data/entries/YYYY-MM-DD/index.json`
- `run.v1.json` — `data/runs/<ISO>.json`

Producers SHOULD add a `version` field when evolving structures (see Versioning) and keep compatibility with `v1` until a breaking change is planned.

## Versioning & Compatibility
- Contract version: major.minor (e.g., `v1.0`)
- Non‑breaking changes (additive fields) are allowed within the same major version.
- Breaking changes require a major bump (e.g., `v2.x`) and a migration notice.
- Data files MAY include `{ "version": "v1.0" }` at the top level. Workflows will move to include this automatically.

## Publishing SLOs
- Triggered manually; typical latency from trigger to commit: < 60s
- Feeds are merged (no overwrites) and sorted newest first
- Per‑run and per‑article files are durable (history preserved)

### Retention & Caps
- Rolling feed cap (configurable via workflow params): `feed_max_latest` (default 200)
- Daily feed cap (configurable): `feed_max_snapshot` (default 500)
- Historical partitions under `data/entries/YYYY‑MM‑DD/` are not pruned by the workflow; retention can be managed via repo history policy if needed.

## Provenance & Audit
- Commit history on GitHub is the audit log
- Per‑run snapshots capture the exact payload produced by the agent, plus runtime params
- Daily indexes summarise each day’s content

## Security & Governance
- Writes require GitHub repo token stored in n8n credentials
- All data is public, read‑only for consumers (via GitHub Pages)
- Personally identifiable information is not collected; only article metadata and links are stored

## Discovery & Indexes (Planned)
- `data/index/by-topic.json` — counts by topic across the last N days
- `data/index/by-country.json` — counts by country across the last N days
- `data/index/catalog.json` — list of available `YYYY‑MM‑DD` partitions and counts

These are generated by adding three short Code+HTTP sequences to DEBUG006 (see below).

## n8n Add‑Ons (Master Indexes)
Add these branches after `DIRECT_NORMALIZE`:

1) Build by‑topic / by‑country (last 7 days)
- Code node `BUILD_MASTER_INDEX`:
```
// Reads today’s articles; extend to also read last 7 snapshots if available
const arts = Array.isArray($json.articles) ? $json.articles : [];
const topics = new Map();
const countries = new Map();
for (const a of arts){
  for (const t of (a.topics||[])) topics.set(t, (topics.get(t)||0)+1);
  const c = a.country || 'Regional'; countries.set(c, (countries.get(c)||0)+1);
}
const byTopic = Object.fromEntries([...topics.entries()].sort());
const byCountry = Object.fromEntries([...countries.entries()].sort());
const payload = JSON.stringify({ version:'v1.0', generated_at:new Date().toISOString(), byTopic, byCountry }, null, 2);
const content = Buffer.from(payload).toString('base64');
function paramsOf(name){ try{const it=$items(name,0,0);return it?.json?.params||{};}catch{return{};} }
const p = paramsOf('BUILD_PARAMS');
const owner=p.repoOwner||'vulcanoai'; const repo=p.repoName||'vulcanoai.github.io'; const branch=p.branch||'main';
const base=`https://api.github.com/repos/${owner}/${repo}/contents`;
return [{ json:{ base, branch, path:'data/index/by-topic.json', content, message:'chore(index): by-topic' } },
        { json:{ base, branch, path:'data/index/by-country.json', content, message:'chore(index): by-country' } }];
```
- For each output, GET sha → build PUT body → PUT (same pattern used elsewhere).

2) Build catalog of days
- Code node `BUILD_CATALOG`:
```
const today = new Date().toISOString().slice(0,10);
const payload = JSON.stringify({ version:'v1.0', generated_at:new Date().toISOString(), days:[ today ] }, null, 2);
const content = Buffer.from(payload).toString('base64');
function paramsOf(name){ try{const it=$items(name,0,0);return it?.json?.params||{};}catch{return{};} }
const p = paramsOf('BUILD_PARAMS');
const owner=p.repoOwner||'vulcanoai'; const repo=p.repoName||'vulcanoai.github.io'; const branch=p.branch||'main';
const base=`https://api.github.com/repos/${owner}/${repo}/contents`;
return [{ json:{ base, branch, path:'data/index/catalog.json', content, message:'chore(index): catalog' } }];
```
- Wrap with GET sha → PUT as above.

## Consumer Guidance
- Prefer `/data/feed-latest.json`, fallback to `/data/feed-YYYY‑MM‑DD.json`
- For analytics or exploration use daily indexes and per‑article entries
- Expect at‑least‑once semantics during manual triggers; dedupe by URL

## Roadmap
- Include `version` in all artifacts (feeds, runs, entries, index)
- Generate and publish master indexes under `data/index/`
- Optional: add `data/search/` endpoints (precomputed search indexes)
- Optional: per‑topic feeds under `data/feeds/topic/<topic>.json`
